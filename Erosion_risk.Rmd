---
title: Soil erosion/deposition risk assessments with spatial association rules
author: M.G. Walsh
date: "`r format(Sys.time(), '%d, %B, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    fig_caption: true
    css: style.css
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

# Introduction

Soil erosion is the natural process of soil removal by rainfall, running water, and/or wind. Of these geological forces, erosion by running water is by far the most important in Rwanda's watersheds. In croplands, the susceptibility of any soil to erosion depends on physical and chemical characteristics of soils (erodibility), vegetation cover, topographic position (slope length and gradient), the intensity (erosivity) of rainfall, and the resulting velocity (transport capacity) of runoff water [Cohen et al., (2004)](https://www.researchgate.net/publication/235936792_Empirical_reformulation_of_the_Universal_Soil_Loss_Equation_for_erosion_risk_assessment_in_a_tropical_watershed). 

Sedimentation (or sorted soil particle deposition) occurs when eroded soil accumulates where water flows are slowed. Sedimentation and its associated environmental impacts (e.g., phosphorus, nitrogen and heavy metal) pollution are most pronounced where rivers (e.g., the Akagera River flowing into Lake Victoria, the Sebeya River flowing into Lake Kivu, etc.), or more generally where streams enter any lowland lakes, ponds, and wetlands. The natural geologic processes of erosion and sedimentation are frequently accelerated by upstream land use practices and urban development. However, the associated risk factors remain poorly described in Rwanda.

*The main purpose of this notebook is to provide an initial national summary and code for erosion/deposition risk assessments based on readily available remote sensing, GIS and observational data. Models of erosion and deposition risk management require information about the source, sink and effects of sediment and associated nutrients (such as phosphorus). The initial analyses presented can be used to improve erosion/deposition monitoring and management impact assessments.*

# General data setup

The example data we will be using were generated by the [RwaSIS](https://doi.org/10.17605/OSF.IO/Y9ZUT) project in Rwanda. They currently consist of >22k georeferenced, time stamped, and photo tagged, GeoSurvey observations of land cover that were observed in 6.25 ha quadrates, in proportion to their national occurrence, in 2019. The spatially representative sampling frame that was used is described in ... .

To actually run this notebook, you will need to load the R-packages that are indicated in the chunk directly below to download, assemble and model the data. You can find all of the documentation of these packages on [CRAN](https://cran.r-project.org/).

```{r}
# Package names
packages <- c("osfr", "tidyverse", "leaflet", "arules", "arulesViz", "caret", "arulesCBA")

# Install packages
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Load packages
invisible(lapply(packages, library, character.only = TRUE))
```

## Data downloads



# Association rules

We will be using a workflow based on the concept of strong rules. *"Strong rules"* were introduced by [Agrawal et al., (1993)](https://dl.acm.org/doi/10.1145/170036.170072) in the context of [affinity analysis](https://en.wikipedia.org/wiki/Affinity_analysis). There are three main metrics of interest in the application of strong rules are: *support*, *confidence* and *lift*.

* *Support* tells us the joint probability of instances where crops A and B i.e., `p(A,B)` occur. This helps identify and contrast combinations that are sufficiently frequent to be of interest (e.g., growing maize in combination with various other crops). Conversely, it also tells us about the probability of various combinations that are rare (*sensu*, [anomaly detection](https://en.wikipedia.org/wiki/Anomaly_detection)).

* *Confidence* tells us the conditional probability of instances that have staple B given that they have staple A (i.e., `p(B|A)`) e.g., the instances that have bean, cattle, banana, etc, given that they have maize. This also contrasts potentially rare associations such as the probability of e.g., `p(yam|maize)`.

* *Lift* is calculated as the ratio of the joint probability of two crops A and B, divided by the product of their probabilities i.e., `P(A,B)/(P(A)P(B))`. If the two items are statistically independent, then the joint probability of the two items will be the same as the product of their probabilities. In other words, `P(A,B) = P(A)P(B)`, which makes the lift factor = 1. Worth mentioning is that anti-correlations can yield lift values that are less than 1, which correspond to mutually exclusive crops combinations that rarely occur together.

Typically, association rules are considered to be interesting if they satisfy at least both support and confidence thresholds. These thresholds can/should be set by subject matter specialists e.g., agronomists and/or nutritionists. Note that there are some good, short tutorials available on YouTube that you might wish to consult to clarify the terminology in this context (e.g., https://www.youtube.com/watch?v=WGlMlS_Yydk).

# Takeaways

* This result suggests a critical need for efficient ground-based sampling schemes to be used in conjunction with flexible statistical models based onUSLE factors for future investments in erosion risk assessment in the tropics.
