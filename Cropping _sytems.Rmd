---
title: Workflows for association rule mining of staple food indicator species
author: M.G. Walsh, R. Manners, R. Rodríguez Iglesias, J. Meliyo, and J. Rutebuka
date: "`r format(Sys.time(), '%d, %B, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    fig_caption: true
    css: style.css
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(message = FALSE)
```

# Introduction

The prevailing smallholder, staple food cropping systems in East Africa stand in stark contrast to the industrial agricultural practices elsewhere that rely on reduced labor through mechanization, consolidation of farms and fields, the occurrence of large areas of monocrops, and increased external agricultural inputs such as fossil fuels, electricity, irrigation, GMOs, improved / patented seed, chemical fertilizers, lime, pesticides and herbicides. The increased reliance on external inputs in turn often come at economic, health, nutritional, environmental and/or [Ecosystem service](https://en.wikipedia.org/wiki/Ecosystem_service) costs to smallholder farmers and rural communities (see [Rockström et al., 2017](https://link.springer.com/article/10.1007/s13280-016-0793-6)). 

Smallholder production systems in East Africa are generally [Intercropped](https://en.wikipedia.org/wiki/Intercropping) and/or at least [Rotated](https://en.wikipedia.org/wiki/Crop_rotation), rather than [Monocropped](https://en.wikipedia.org/wiki/Monocropping), during a given cropping season. Even quite small (e.g. 0.25 ha) areas will usually contain multiple crops at the same time during any given cropping season ... unlike in most cropland areas in Iowa, Brazil or many parts of Europe. It is not possible to gauge or manage the ensuing agroecological interactions and complexities without knowing where specific staple crop species occur or how the associated cropping systems may be evolving over time due changing ecological, market conditions and/or consumer preferences. 

*The main objective of this notebook is to provide starter code in [R](https://www.r-project.org/) for classifying cropping systems in Tanzania and Rwanda. The data include georeferenced observations of the co-occurrence of: maize, millet, wheat, sorghum, rice, bean, chickpea, pigeon pea, cowpea, soybean, groundnut, Irish potatoes, sweet potatoes, cassava and banana / plantain, in addition to livestock as well as the combined presence / absence of numerous other more localized food, oil, beverage and fiber crops. The markdown notebook presented here is maintained on [Github](https://github.com/mgwalsh/RwaSIS/blob/master/Cropping%20_sytems.Rmd), and you can fork and alter it from there for your reference, and as you see fit.*

We will be using [Association rule mining](https://en.wikipedia.org/wiki/Association_rule_learning) workflows, based on the concept of strong rules. *"Strong rules"* were introduced by [Agrawal et al., (1993)](https://dl.acm.org/doi/10.1145/170036.170072) in the context of [Affinity analysis](https://en.wikipedia.org/wiki/Affinity_analysis). We use these in this notebook to identify cropping systems based on staple crop indicator species.

# General data setup

The data we will be using were generated by the [TanSIS]() and [RwaSIS]() projects located in Tanzania and Rwanda respectively. They consist of <n> georeferenced, time stamped, and ground photo tagged, field survey observations of staple crops that have been observed in 0.25 ha circular plots (~28.2 m radius), in proportion to their national occurrence. The spatially representative cropland sampling frames that are used in these ongoing survey data collections are described in [Walsh, Rutebuka and Manners (2021)](https://github.com/mgwalsh/RwaSIS/blob/master/RwaSIS_cropland_sample.Rmd). A field data collection framework (CropScout) has also been posted on [KoboToolbox](https://kobo.humanitarianresponse.info/#/forms/a3jwzkBTtDvdaZJgR6YjAe/), which you can either use directly or modify for your own use with Open Data Kit ([ODK](https://opendatakit.org/)).

## Package loads

To actually run this notebook, you will need to load the packages indicated in the chunk directly below to download and assemble the data. You can find all of the documentation of these packages on [CRAN](https://cran.r-project.org/). Note that additional, more specialized, package installs will be needed in the later sections of this notebook. We shall deal with those as they arise.

```{r}
# Package names
packages <- c("osfr", "leaflet", "htmlwidgets")

# Install packages
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Load packages
invisible(lapply(packages, library, character.only = TRUE))
```

## Data downloads

The survey (label) data downloads can be obtained with this next chunk. The chunk (not shown but in the markdown document) also generates an overview map of where the observations were collected in Tanzania and Rwanda ... you can click and zoom into the individual locations.

```{r, results = 'hide'}
# Create a data folder in  your current working directory
dir.create("Cropping_systems", showWarnings=F)
setwd("./Cropping_systems")
dir.create("Results", showWarnings=F)

# Download crop survey data
osf_retrieve_file("md934") %>% osf_download(conflicts = "overwrite")
unzip("TZ_RW_crop_systems.csv.zip", overwrite = T)
crops <- read.table("TZ_RW_crop_systems.csv", header = T, sep = ",")
```

```{r, echo = FALSE}
# CropScout sample locations
w <- leaflet() %>%
  setView(lng = mean(crops$lon), lat = mean(crops$lat), zoom = 6) %>%
  addProviderTiles(providers$OpenStreetMap.Mapnik) %>%
  addCircleMarkers(crops$lon, crops$lat, clusterOptions = markerClusterOptions())
w ## plot widget 
```


# Links to recipes

