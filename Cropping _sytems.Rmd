---
title: Workflows for association rule mining of staple food indicator species
author: M.G. Walsh, R. Manners, and J. Rutembuka
date: "`r format(Sys.time(), '%d, %B, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    fig_caption: true
    css: style.css
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(message = FALSE)
```

# Introduction

Smallholder crop production systems in East Africa are generally [Intercropped](https://en.wikipedia.org/wiki/Intercropping) and/or [Rotated](https://en.wikipedia.org/wiki/Crop_rotation), rather than [Monocropped](https://en.wikipedia.org/wiki/Monocropping). Even quite small, e.g., 0.5 ha, areas will usually contain multiple crops during a given season. It is not possible to gauge nor manage the ensuing agroecological interactions and complexities without knowing where specific crops occur or how the associated cropping systems may be fluctuating or evolving over time in response to changing environmental constraints, local, national or international market conditions, food production policies, and/or consumer preferences. 

Staple food cropping systems and management practices in East Africa generally also stand in stark contrast to food production practices elsewhere e.g., in the [4-largest food producing countries globally](https://www.investopedia.com/articles/investing/100615/4-countries-produce-most-food.asp): the US, China, India and Brazil. Commercial agriculture in industrialized countries increasingly relies on the occurrence of large areas of monocrops, reduced labor through mechanization, consolidation of farms and fields, and external agricultural inputs such as fossil fuels, electricity, irrigation, improved / patented seed, GMOs, chemical fertilizers, lime, pesticides and herbicides. The increased reliance on external inputs in turn often come at economic, health, nutritional, environmental and/or [Ecosystem service](https://en.wikipedia.org/wiki/Ecosystem_service) costs to smallholder farmers and rural communities (see [Rockstr√∂m et al., 2017](https://link.springer.com/article/10.1007/s13280-016-0793-6)). 

*The main objective of this notebook is to provide starter code in [R](https://www.r-project.org/) for classifying crop production systems in Tanzania and Rwanda. The data include georeferenced observations of the co-occurrence of: cattle,	sheep, goats, poultry, maize, wheat, sorghum,	rice,	bean,	cowpea,	pigeon pea,	soybean, groundnut, Irish potato,	sweet potato,	cassava, yam, taro, banana, sugarcane, and sunflower. The markdown notebook presented here is maintained on [Github](https://github.com/mgwalsh/RwaSIS/blob/master/Cropping%20_sytems.Rmd), and you can fork and alter it from there for your reference, and as you see fit.*

We will be using [Association rule mining](https://en.wikipedia.org/wiki/Association_rule_learning) workflows, based on the concept of strong rules. *"Strong rules"* were introduced by [Agrawal et al., (1993)](https://dl.acm.org/doi/10.1145/170036.170072) in the context of [Affinity analysis](https://en.wikipedia.org/wiki/Affinity_analysis). We'll explore these in this notebook to identify cropping systems based on staple crop indicator species that can be used for downstream analyses e.g., mapping.

# General data setup

The data I will be using were generated by the [RwaSIS]() project in Rwanda. They consist of <n> georeferenced, time stamped, and ground photo tagged, field survey observations of staple crops that have been observed in 0.5 ha circular plots (~39.9 m radius), in proportion to their national occurrence. The spatially representative cropland sampling frames that are used in these ongoing survey data collections are described in [Walsh, Rutebuka and Manners (2021)](https://github.com/mgwalsh/RwaSIS/blob/master/RwaSIS_cropland_sample.Rmd). A field data collection framework (CropScout) has also been posted on [KoboToolbox](https://kobo.humanitarianresponse.info/#/forms/a3jwzkBTtDvdaZJgR6YjAe/), which you can either use directly or modify for your own use with Open Data Kit ([ODK](https://opendatakit.org/)).

## Package installs

To actually run this notebook, you will need to load the packages indicated in the chunk directly below to download and assemble the data. You can find all of the documentation of these packages on [CRAN](https://cran.r-project.org/). Note that additional, more specialized, package installs will be needed in the later sections of this notebook. We shall deal with those as they arise.

```{r}
# Package names
packages <- c("osfr", "leaflet", "htmlwidgets")

# Install packages
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Load packages
invisible(lapply(packages, library, character.only = TRUE))
```

## Data downloads

The survey (label) data downloads can be obtained with this next chunk. The chunk (not shown, but in the markdown document) also generates an overview map of where the observations were collected in Tanzania and Rwanda ... you can click and zoom into the individual locations.

```{r, results = 'hide'}
# Create a data folder in  your current working directory
dir.create("Cropping_systems", showWarnings=F)
setwd("./Cropping_systems")
dir.create("Results", showWarnings=F)

# Download crop survey data
osf_retrieve_file("md934") %>% osf_download(conflicts = "overwrite")
unzip("TZ_RW_crop_systems.csv.zip", overwrite = T)
staple <- read.table("TZ_RW_crop_systems.csv", header = T, sep = ",")
```

```{r, echo = FALSE}
# CropScout sample locations
w <- leaflet() %>%
  setView(lng = mean(staple$lon), lat = mean(staple$lat), zoom = 7) %>%
  addProviderTiles(providers$OpenStreetMap.Mapnik) %>%
  addCircleMarkers(staple$lon, staple$lat, clusterOptions = markerClusterOptions())
w ## plot widget 
```

# Main takeaways

The main takeaways of this notebook are the following:

* 

Any questions, comments or corrections about this notebook are most welcome via [AFSIS](mailto:mgw.africasoils.info).

# Links to staple food recipes

There are some delicious recipes out there for using the staple crops indicated this notebook for meals (some of these are also quite nutritious). Interestingly cooking advisories such as [Supercook](https://www.supercook.com/#/recipes) and [Allrecipes](https://www.allrecipes.com/search/results/?search=) are also using new recommendation algorithms to provide meal options based on what ingredients you have available, or may want to have available, in your fridge and dry-goods store. If you are a smallholder in East Africa, those ingredients will largely depend on what you are growing on your land and whatever your breakfast, lunch or dinner preferences and tastes are. Maybe we (data scientists) should also start to work back from those preferences and tastes?


