---
title: Meta-analyses of agricultual lime application effects on crop yields with field trial data
author: M.G. Walsh, R. Manners, J.V. Silva and S. Aston
date: "`r format(Sys.time(), '%d, %B, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    fig_caption: true
    css: style.css
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(message = FALSE)
```

# About this notebook

Soil acidity affects soil nutrient availability and microbial activity and is thought to reduce crop growth and yield. For example, in Rwanda virtually all of the currently surveyed cropland soils are acid (pH < 7 in water) and ~64% are strongly acid (with pH < 5.5); also, see the associated notebook about Rwanda's [Cropland soil acidity](). Moreover, commonly used nitrogen fertilizer sources that supply ammonium or that react in the soil to produce ammonium (e.g., ammonium nitrate, urea, manure and compost) tend to decrease soil pH over time. The application of [Agricultural lime (aglime)](https://en.wikipedia.org/wiki/Agricultural_lime) can be used to mitigate the effects of soil acidity on soil nutrient availability, reduced microbial activity, and aluminium and/or manganese toxicities on crop yields (e.g., see the extension advice from [PennState Extension](https://extension.psu.edu/soil-acidity-and-aglime)). The rocks and minerals from which agricultural lime is derived, typically [Limestone](https://en.wikipedia.org/wiki/Limestone) but also [Chalk](https://en.wikipedia.org/wiki/Chalk), are primarily composed of calcium carbonate (CaCO~3~) and/or magnesium carbonate (MgCO~3~). Both limestone and chalk can be pulverized and/or chemically altered to produce different aglime products. However, and similar to chemical fertilizers, the use of aglime also generates significant greenhouse gas emissions in its production, to-farm-gate transport and through its field application.

*The main objective of this notebook is to illustrate the use of standard meta-analysis techniques for assessing the effects of aglime applications on maize and bean yields in Rwanda. Rwanda was selected for this illustration because of the high prevalence of acid soils within its croplands, as well as the availability of a relatively large, recent, multi-year, field trial dataset that is suitable for this purpose. The notebook itself is maintained on [Github](https://github.com/mgwalsh/Soils/blob/master/Spec_acidity_preds.Rmd), and you can fork and modify it from there as you see fit.*

A [Meta-analysis (MA)](https://en.wikipedia.org/wiki/Meta-analysis) is an analytical approach that uses statistical techniques to combine the results from different studies (experiments and multi-locational trials) to obtain quantitative estimates of the overall effects of particular interventions or variables on defined outcomes. Generally, the aim is to derive a pooled estimate of a common outcome, based on the relevant sources of variation across studies. The scope of MAs is defined by the type of population, the types of interventions (and their controls or comparators), and the types of outcomes that are of interest. The acronym PICO (population, interventions, comparators and outcomes) helps to serve as a reminder of these (e.g., see the [Cochrane Handbook](https://training.cochrane.org/handbook)). We will follow the Cochrane guidance here and will go through some of the relevant steps including exploratory data analysis ([EDA](https://en.wikipedia.org/wiki/Exploratory_data_analysis)), [outlier detection](https://en.wikipedia.org/wiki/Anomaly_detection), [data modeling](https://en.wikipedia.org/wiki/Data_modeling) and interpretation.

# General data set up

The data we will be using in this notebook were generated by the [One Acre Fund (1AF)](https://oneacrefund.org/). Two separate field studies were conducted by 1AF as part of their soil acidity management intervention testing and monitoring activities in Rwanda during 2016-2017 and 2019-2020. They consist of 2,166 individual field trials (with multiple treatments) to assess the effects of aglime applications on crop (maize & bean) yields against the relevant control yields (i.e., no lime application). The 2 studies were conducted in 20 Level-4 administrative units (Sectors), two of which overlap by study. This defines the general **PICO** that are analyzed here. Specific treatments and variables are described in more detail below. 

To actually run this notebook, you will need to load the packages indicated in the chunk directly below to download, assemble and analyze the Rwanda lime trial data.

```{r, results = 'hide'}
# Package names
packages <- c("osfr", "dplyr", "solitude", "MASS", "stargazer", "arm")

# Install packages
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Load packages
invisible(lapply(packages, library, character.only = TRUE))
```

The next chunk then downloads pre-processed trial data from the [RwaSIS OSF repository](). The raw data are openly available from [1AF]() upon request.

```{r, results = 'hide'}
# Create a data folder in your current working directory
dir.create("RW_lime", showWarnings=F)
setwd("./RW_lime")
dir.create("Results")

# Trial data download from OSF at: https://osf.io/btxyc/
osf_retrieve_file("btxyc") %>% osf_download(conflicts = "overwrite")
codat <- read.table("MW_grain_CoDa.csv", header=T, sep=",")

# Download figures at: at: https://osf.io/pnw7g/
osf_retrieve_file("pnw7g") %>% osf_download(conflicts = "overwrite")
```

# Rwanda trial data EDAs



# Outlier detection

Note that there are quite a few outliers apparent in the boxplots above. This short section demonstrates an unsupervised anomaly and outlier detection method that is based on machine learning (see [Liu, Ting and Zhou (2008)](https://cs.nju.edu.cn/zhouzh/zhouzh.files/publication/tkdd11.pdf). We will be using the `isolationForest` function from the [`solitude`](https://www.rdocumentation.org/packages/solitude/versions/1.1.1) package here, with default tuning parameters. We also plan to expand on anomaly and outlier detection more in subsequent notebooks, so this next chunk should be considered as just an initial draft.

# Takeaways

The main takeaways of this notebook are the following:

* 

Any questions, comments or corrections related to this notebook are most welcome via [AFSIS](mailto:mgw.africasoils.info).

